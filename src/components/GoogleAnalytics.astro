---
const measurementId = import.meta.env.PUBLIC_GA_MEASUREMENT_ID;
---

<!-- Google Analytics Script -->
<script type="text/partytown" define:vars={{ measurementId }}>
  // Google Analytics 4 initialization
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', measurementId, {
    send_page_view: false // We'll handle page views manually for better SPA tracking
  });

  // Track page views including client-side navigation
  function handlePageView() {
    gtag('event', 'page_view', {
      page_title: document.title,
      page_location: window.location.href,
      page_path: window.location.pathname
    });
  }

  // Initial page view
  handlePageView();

  // Track client-side navigation
  document.addEventListener('astro:page-load', handlePageView);
</script>

<!-- Google Analytics Tag -->
<script type="text/partytown" src={`https://www.googletagmanager.com/gtag/js?id=${measurementId}`}></script> 